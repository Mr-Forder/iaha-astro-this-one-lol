---
const { limit = 6, currentPage = 1 } = Astro.props;
const allPosts = Object.values(
  import.meta.glob("../pages/posts/*.md", { eager: true })
)
  .filter((post: any) => {
    const isScheduled =
      new Date(post.frontmatter.pubDate).getTime() > Date.now();
    return !isScheduled;
  })
  .sort((a: any, b: any) => {
    return (
      new Date(b.frontmatter.pubDate).getTime() -
      new Date(a.frontmatter.pubDate).getTime()
    );
  });

// Calculate pagination values
const totalPosts = allPosts.length;
const totalPages = Math.ceil(totalPosts / limit);
const startIndex = (currentPage - 1) * limit;
const endIndex = startIndex + limit;
const paginatedPosts = allPosts.slice(startIndex, endIndex);
---

<section class="section">
  <div class="w-layout-blockcontainer main-container w-container">
    <div class="headline-related">
      <div class="text-h3">Latest articles</div>
    </div>
    <div class="related-block w-dyn-list">
      <div role="list" class="blog-thirds w-dyn-items">
        {
          paginatedPosts.map((post: any) => (
            <div role="listitem" class="w-dyn-item">
              <a href={post.url} class="article-tile w-inline-block">
                <div class="image-wrap-blog">
                  <img
                    alt=""
                    loading="lazy"
                    src={post.frontmatter.image.url}
                    sizes="(max-width: 479px) 100vw, (max-width: 767px) 44vw, (max-width: 991px) 46vw, 30vw"
                    class={post.frontmatter.image.alt}
                  />
                </div>
                <div class="article-info-wrap">
                  <div class="article-category-wrap">
                    <div class="text-small">{post.frontmatter.alt}</div>
                    <div class="text-small opacity-50">Â·</div>
                    <div class="text-small">
                      {post.frontmatter.pubDate.split("T")[0]}
                    </div>
                  </div>
                  <div class="text-h5">{post.frontmatter.description}</div>
                </div>
              </a>
            </div>
          ))
        }
      </div>

      {
        totalPages > 1 && (
          <div
            role="navigation"
            aria-label="Pagination"
            class="w-pagination-wrapper pagination blog-pagination"
          >
            {currentPage > 1 && (
              <a
                href={`?page=${currentPage - 1}`}
                aria-label="Previous Page"
                class="w-pagination-previous pagination-button-article"
              >
                <div class="text-h3 w-inline-block">Previous</div>
              </a>
            )}

            <div class="pagination-info">
              <span class="text-small">
                Page {currentPage} of {totalPages}
              </span>
            </div>

            {currentPage < totalPages && (
              <a
                href={`?page=${currentPage + 1}`}
                aria-label="Next Page"
                class="w-pagination-next pagination-button-article"
              >
                <div class="text-h3 w-inline-block">Next</div>
              </a>
            )}
          </div>
        )
      }
    </div>
  </div>
</section>

<style>
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 2rem;
  }

  .pagination-info {
    display: flex;
    align-items: center;
    padding: 0 1rem;
  }
</style>
